javascript:(function(){if(window.grabAndAskInjected&&window.grabAndAskTimeout&&Date.now()-window.grabAndAskTimeout>120000){window.grabAndAskInjected=false;}if(window.grabAndAskInjected)return alert("Inspector already active! Click Cancel to reset.");window.grabAndAskInjected=true;window.grabAndAskTimeout=Date.now();window.elementTasks=window.elementTasks||[];const toast=document.createElement('div');Object.assign(toast.style,{position:'fixed',bottom:'20px',right:'20px',background:'#007acc',color:'white',padding:'12px 24px',borderRadius:'8px',fontFamily:'system-ui',zIndex:99999,boxShadow:'0 4px 12px rgba(0,0,0,0.2)',fontWeight:'500'});toast.textContent='Click elements to add tasks (0/10)';document.body.appendChild(toast);let hovered=null;let captureMode=true;const taskPanel=document.createElement('div');taskPanel.className='task-panel-ignore';taskPanel.style.cssText='position:fixed;bottom:20px;right:20px;width:350px;max-height:500px;background:#1e1e1e;color:#fff;border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:system-ui;z-index:100002;display:none;overflow:hidden;';taskPanel.innerHTML=`<div style="padding:12px 16px;border-bottom:1px solid #444;display:flex;align-items:center;justify-content:space-between;"><h3 style="margin:0;font-size:14px;font-weight:600;">Task List (<span class="task-count">0</span>/10)</h3><div style="display:flex;gap:6px;"><button class="minimize-btn" title="Minimize" style="background:none;border:none;color:#999;cursor:pointer;font-size:18px;padding:0;width:24px;height:24px;">−</button><button class="close-panel" title="Close" style="background:none;border:none;color:#999;cursor:pointer;font-size:18px;padding:0;width:24px;height:24px;">×</button></div></div><div class="task-list" style="padding:12px;max-height:350px;overflow-y:auto;"></div><div style="padding:12px;border-top:1px solid #444;display:flex;gap:8px;"><button class="send-all-btn" style="flex:1;padding:8px;background:#007acc;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:12px;">Send to VS Code</button><button class="copy-clipboard-btn" style="flex:1;padding:8px;background:#28a745;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:12px;">Copy</button><button class="clear-all-btn" style="padding:8px 12px;background:#444;color:white;border:none;border-radius:4px;cursor:pointer;font-size:12px;">Clear</button></div>`;document.body.appendChild(taskPanel);const taskListEl=taskPanel.querySelector('.task-list');const taskCountEl=taskPanel.querySelector('.task-count');const sendAllBtn=taskPanel.querySelector('.send-all-btn');const copyClipboardBtn=taskPanel.querySelector('.copy-clipboard-btn');const clearAllBtn=taskPanel.querySelector('.clear-all-btn');const closePanelBtn=taskPanel.querySelector('.close-panel');const minimizeBtn=taskPanel.querySelector('.minimize-btn');let minimized=false;function showToast(message,bgColor='#007acc',duration=2500){const toastMsg=document.createElement('div');toastMsg.style.cssText=`position:fixed;bottom:20px;right:20px;background:${bgColor};color:white;padding:12px 24px;border-radius:8px;font-family:system-ui;z-index:99999;box-shadow:0 4px 12px rgba(0,0,0,0.2);font-weight:500;`;toastMsg.textContent=message;document.body.appendChild(toastMsg);setTimeout(()=>toastMsg.remove(),duration);}function updateTaskCount(){const count=window.elementTasks.length;taskCountEl.textContent=count;toast.textContent=count>=10?'Limit reached (10/10) - Time to send!':`Click elements to add tasks (${count}/10)`;toast.style.background=count>=10?'#dc3545':'#007acc';}function renderTaskList(){taskListEl.innerHTML='';window.elementTasks.forEach((task,idx)=>{const taskItem=document.createElement('div');taskItem.style.cssText='background:#2d2d2d;padding:8px;border-radius:4px;margin-bottom:6px;border:1px solid #444;display:flex;align-items:center;gap:6px;';taskItem.innerHTML=`<input type="checkbox" ${task.completed?'checked':''} data-idx="${idx}" style="cursor:pointer;"><input class="inline-comment" data-idx="${idx}" value="${task.request||''}" placeholder="comment…" style="flex:1;background:transparent;border:none;color:#fff;font-size:12px;padding:2px 4px;border-bottom:1px solid #444;outline:none;"><button class="remove-task" data-idx="${idx}" style="background:none;border:none;color:#dc3545;cursor:pointer;font-size:14px;">×</button>`;taskListEl.appendChild(taskItem);});taskListEl.querySelectorAll('.inline-comment').forEach(inp=>{inp.addEventListener('input',e=>{window.elementTasks[e.target.dataset.idx].request=e.target.value;});});taskListEl.querySelectorAll('.remove-task').forEach(btn=>{btn.addEventListener('click',e=>{window.elementTasks.splice(e.target.dataset.idx,1);renderTaskList();updateTaskCount();});});}function toggleMinimize(){minimized=!minimized;taskPanel.querySelector('.task-list').style.display=minimized?'none':'block';taskPanel.querySelector('.send-all-btn').parentElement.style.display=minimized?'none':'flex';minimizeBtn.textContent=minimized?'+':'−';}minimizeBtn.onclick=toggleMinimize;closePanelBtn.onclick=()=>{taskPanel.style.display='none';};clearAllBtn.onclick=()=>{if(confirm('Clear all tasks?')){window.elementTasks=[];renderTaskList();updateTaskCount();taskPanel.style.display='none';showToast('✓ All items cleared','#dc3545');}};copyClipboardBtn.onclick=()=>{let formattedOutput='<!-- URL: '+location.href+' -->\n\n';formattedOutput+='## TASK LIST\n';formattedOutput+='==========\n\n';window.elementTasks.forEach((task,idx)=>{formattedOutput+=`${idx+1}. [${task.completed?'✓':' '}] ${task.request||'No description'}\n`;formattedOutput+=`   Reference: #element-${idx+1}\n`;});formattedOutput+='\n\n## HTML REFERENCES\n';formattedOutput+='================\n\n';window.elementTasks.forEach((task,idx)=>{formattedOutput+=`<!-- #element-${idx+1} -->\n`;formattedOutput+=task.html+'\n\n';});navigator.clipboard.writeText(formattedOutput).then(()=>{showToast('✓ All items copied to clipboard','#28a745');}).catch(err=>{showToast('✗ Failed to copy','#dc3545');console.error(err);});};sendAllBtn.onclick=()=>{const tool='ampcode';sendToVSCode(tool);};document.addEventListener('mouseover',e=>{if(!captureMode||e.target.closest('.task-panel-ignore'))return;if(hovered)hovered.style.outline='';hovered=e.target;hovered.style.outline='2px solid #007acc';});document.addEventListener('click',function(e){if(!captureMode||e.target.closest('.task-panel-ignore'))return;e.preventDefault();e.stopPropagation();const el=e.target;if(el.style)el.style.outline='';if(window.elementTasks.length>=10){return alert('Task limit reached (10/10). Please send or clear tasks first.');}showPromptModal(el);},true);function showPromptModal(element){element.style.outline='3px solid #007acc';element.style.boxShadow='0 0 0 3px rgba(0,122,204,0.3)';const overlay=document.createElement('div');overlay.className='task-panel-ignore';overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:100003;';const box=document.createElement('div');box.className='task-panel-ignore';box.style.cssText='position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#1e1e1e;color:#fff;padding:20px;border-radius:8px;width:400px;box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:system-ui;z-index:100004;';box.innerHTML=`<h2 style="margin:0 0 12px 0;font-size:15px;font-weight:600;">Add Task</h2><label style="display:block;margin-bottom:16px;"><span style="display:block;margin-bottom:6px;font-weight:500;font-size:12px;color:#ccc;">What do you want to change?</span><textarea placeholder="e.g., Make button larger, change color to red, fix alignment..." style="width:100%;padding:8px;background:#2d2d2d;color:#fff;border:1px solid #007acc;border-radius:4px;font-size:12px;font-family:system-ui;resize:vertical;min-height:60px;box-sizing:border-box;"></textarea></label><div style="display:flex;gap:8px;"><button class="add-task-btn" style="flex:1;padding:10px;background:#007acc;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:13px;">Add to List</button></div>`;overlay.appendChild(box);document.body.appendChild(overlay);const textareaEl=box.querySelector('textarea');const addTaskBtn=box.querySelector('.add-task-btn');const cleanup=()=>{element.style.outline='';element.style.boxShadow='';overlay.remove();};addTaskBtn.onclick=()=>{const request=textareaEl.value.trim();const taskId=`element-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;window.elementTasks.push({id:taskId,html:element.outerHTML,request:request,completed:false,xpath:getXPath(element)});renderTaskList();updateTaskCount();taskPanel.style.display='block';cleanup();};overlay.onclick=e=>{if(e.target===overlay)cleanup();};textareaEl.addEventListener('keydown',e=>{if(e.key==='Escape')cleanup();});setTimeout(()=>textareaEl?.focus(),100);}
function getXPath(element){if(element.id!=='')return"//*[@id='"+element.id+"']";if(element===document.body)return element.tagName.toLowerCase();var ix=0;var siblings=element.parentNode.childNodes;for(var i=0;i<siblings.length;i++){var sibling=siblings[i];if(sibling===element)return getXPath(element.parentNode)+'/'+element.tagName.toLowerCase()+'['+(ix+1)+']';if(sibling.nodeType===1&&sibling.tagName.toLowerCase()===element.tagName.toLowerCase())ix++;}return'';}
function sendToVSCode(tool){showToast('Sending to '+tool+'...','#007acc',500);let formattedOutput='<!-- URL: '+location.href+' -->\n\n';formattedOutput+='TASK LIST:\n';formattedOutput+='==========\n\n';window.elementTasks.forEach((task,idx)=>{formattedOutput+=`${idx+1}. [${task.completed?'✓':'○'}] ${task.request||'No description'}\n`;formattedOutput+=`   Reference: #element-${idx+1}\n`;});formattedOutput+='\n\nHTML REFERENCES:\n';formattedOutput+='================\n\n';window.elementTasks.forEach((task,idx)=>{formattedOutput+=`<!-- #element-${idx+1} -->\n`;formattedOutput+=task.html+'\n\n';});fetch('http://localhost:4123/grab',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:location.href,html:formattedOutput,tool:tool,tasks:window.elementTasks,taskCount:window.elementTasks.length})}).then(()=>{showToast('✓ Sent '+window.elementTasks.length+' tasks to '+tool,'#28a745');window.elementTasks=[];renderTaskList();updateTaskCount();taskPanel.style.display='none';}).catch(err=>{showToast('✗ Error: Is VS Code running?','#dc3545',3000);console.error(err);});}
})();