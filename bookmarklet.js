javascript:(function(){if(window.grabAndAskInjected&&window.grabAndAskTimeout&&Date.now()-window.grabAndAskTimeout>120000){window.grabAndAskInjected=false;}if(window.grabAndAskInjected)return alert("Inspector already active! Click Cancel to reset.");window.grabAndAskInjected=true;window.grabAndAskTimeout=Date.now();const toast=document.createElement('div');Object.assign(toast.style,{position:'fixed',bottom:'20px',right:'20px',background:'#007acc',color:'white',padding:'12px 24px',borderRadius:'8px',fontFamily:'system-ui',zIndex:99999,boxShadow:'0 4px 12px rgba(0,0,0,0.2)',fontWeight:'500'});toast.textContent='Click any element to edit';document.body.appendChild(toast);let hovered=null;let captureMode=true;document.addEventListener('mouseover',e=>{if(!captureMode)return;if(hovered)hovered.style.outline='';hovered=e.target;hovered.style.outline='2px solid #007acc';});document.addEventListener('click',function(e){if(!captureMode)return;e.preventDefault();e.stopPropagation();const el=e.target;if(el.style)el.style.outline='';captureMode=false;toast.remove();showPromptModal(el);},true);function getParentHTML(element,levels=1){let parent=element;for(let i=0;i<levels&&parent.parentElement;i++){parent=parent.parentElement;}return parent.outerHTML;}function getModalPosition(element){const rect=element.getBoundingClientRect();const modalWidth=450;const modalHeight=500;const padding=20;const viewportWidth=window.innerWidth;const viewportHeight=window.innerHeight;let left=rect.right+padding;let top=rect.top;if(left+modalWidth>viewportWidth){left=rect.left-modalWidth-padding;}if(left<padding){left=padding;}if(top+modalHeight>viewportHeight){top=viewportHeight-modalHeight-padding;}if(top<padding){top=padding;}return{left:left+'px',top:top+'px'};}function showPromptModal(element){element.style.outline='3px solid #007acc';element.style.boxShadow='0 0 0 3px rgba(0,122,204,0.3)';const position=getModalPosition(element);const overlay=document.createElement('div');overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:100000;';const box=document.createElement('div');box.style.cssText='position:fixed;left:'+position.left+';top:'+position.top+';background:#1e1e1e;color:#fff;padding:24px;border-radius:8px;width:450px;max-height:80vh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:system-ui;z-index:100001;';const tabsHtml='<div style="margin-bottom:16px;"><div class="tabs" style="display:flex;gap:8px;border-bottom:1px solid #444;margin-bottom:12px;"><button class="tab-btn active" data-tab="visual" style="padding:6px 12px;background:none;border:none;color:#fff;cursor:pointer;border-bottom:2px solid #007acc;font-weight:500;font-size:13px;">Preview</button><button class="tab-btn" data-tab="element" style="padding:6px 12px;background:none;border:none;color:#999;cursor:pointer;border-bottom:2px solid transparent;font-size:13px;">HTML Code</button></div><div class="tab-content" data-content="visual" style="display:block;"><div style="background:#2d2d2d;padding:10px;border-radius:4px;max-height:150px;overflow:auto;border:1px solid #444;font-size:11px;font-family:monospace;color:#a0a0a0;">'+element.outerHTML.replace(/</g,'&lt;').replace(/>/g,'&gt;').substring(0,400)+'...</div></div><div class="tab-content" data-content="element" style="display:none;"><pre style="background:#2d2d2d;padding:10px;border-radius:4px;max-height:150px;overflow:auto;margin:0;font-size:10px;border:1px solid #444;white-space:pre-wrap;word-wrap:break-word;color:#a0a0a0;line-height:1.4;">'+element.outerHTML.replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</pre></div></div>';box.innerHTML='<h2 style="margin:0 0 16px 0;font-size:16px;font-weight:600;">Edit Element</h2>'+tabsHtml+'<label style="display:block;margin-bottom:14px;"><span style="display:block;margin-bottom:6px;font-weight:500;font-size:12px;color:#ccc;">What do you want to change?</span><textarea placeholder="e.g., Make button larger, change color to red, fix alignment..." style="width:100%;padding:8px;background:#2d2d2d;color:#fff;border:1px solid #007acc;border-radius:4px;font-size:12px;font-family:system-ui;resize:vertical;min-height:70px;box-sizing:border-box;"></textarea></label><label style="display:block;margin-bottom:16px;"><span style="display:block;margin-bottom:6px;font-weight:500;font-size:12px;color:#ccc;">Select AI Tool:</span><select style="width:100%;padding:8px;background:#2d2d2d;color:#fff;border:1px solid #007acc;border-radius:4px;font-size:13px;"><option value="ampcode">Ampcode</option><option value="antigravity">Antigravity</option><option value="clipboard">Copy to Clipboard</option></select></label><div style="display:flex;gap:8px;"><button class="send-btn" style="flex:1;padding:10px;background:#007acc;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:13px;">Send</button><button class="cancel-btn" style="flex:1;padding:10px;background:#444;color:white;border:none;border-radius:4px;cursor:pointer;font-size:13px;">Cancel</button></div>';overlay.appendChild(box);document.body.appendChild(overlay);const tabBtns=box.querySelectorAll('.tab-btn');const tabContents=box.querySelectorAll('.tab-content');tabBtns.forEach(btn=>{btn.onclick=()=>{tabBtns.forEach(b=>{b.style.color='#999';b.style.borderBottomColor='transparent';b.classList.remove('active');});tabContents.forEach(c=>c.style.display='none');btn.style.color='#fff';btn.style.borderBottomColor='#007acc';btn.classList.add('active');const targetTab=btn.getAttribute('data-tab');box.querySelector('[data-content="'+targetTab+'"]').style.display='block';};});const selectEl=box.querySelector('select');const textareaEl=box.querySelector('textarea');const sendBtn=box.querySelector('.send-btn');const cancelBtn=box.querySelector('.cancel-btn');const cleanup=()=>{element.style.outline='';element.style.boxShadow='';};sendBtn.onclick=(e)=>{e.stopPropagation();const tool=selectEl.value;const request=textareaEl.value.trim();const parentHtml=getParentHTML(element,1);sendToVSCode(element,parentHtml,tool,request);cleanup();overlay.remove();window.grabAndAskInjected=false;};cancelBtn.onclick=(e)=>{e.stopPropagation();cleanup();overlay.remove();window.grabAndAskInjected=false;};overlay.onclick=(e)=>{if(e.target===overlay){cleanup();overlay.remove();window.grabAndAskInjected=false;}};setTimeout(()=>textareaEl?.focus(),100);}function getXPath(element){if(element.id!=='')return"//*[@id='"+element.id+"']";if(element===document.body)return element.tagName.toLowerCase();var ix=0;var siblings=element.parentNode.childNodes;for(var i=0;i<siblings.length;i++){var sibling=siblings[i];if(sibling===element)return getXPath(element.parentNode)+'/'+element.tagName.toLowerCase()+'['+(ix+1)+']';if(sibling.nodeType===1&&sibling.tagName.toLowerCase()===element.tagName.toLowerCase())ix++;}return'';}function getParentContext(element,depth=3){let html='';let current=element;for(let i=0;i<depth&&current;i++){const tag=current.tagName.toLowerCase();const classes=current.className?'.'+current.className.split(' ').join('.'):'';const id=current.id?'#'+current.id:'';html=tag+id+classes+(html?' > '+html:'');current=current.parentElement;}return html;}function getSourceContext(element){let context=[];let current=element;let depth=0;while(current&&depth<5){if(current.dataset){if(current.dataset.sourceFile)context.push('File: '+current.dataset.sourceFile);if(current.dataset.sourceFunction)context.push('Function: '+current.dataset.sourceFunction);if(current.dataset.sourceComponent)context.push('Component: '+current.dataset.sourceComponent);if(current.dataset.sourceLine)context.push('Line: '+current.dataset.sourceLine);}current=current.parentElement;depth++;}if(window.sourceContext){context.push('Source File: '+window.sourceContext.file);}return context.length?context.join('\n'):'No source data available';}function sendToVSCode(element,parentHtml,tool,request){const msg=document.createElement('div');msg.style.cssText='position:fixed;bottom:20px;right:20px;background:#007acc;color:white;padding:12px 24px;border-radius:8px;font-family:system-ui;z-index:99999;box-shadow:0 4px 12px rgba(0,0,0,0.2);transition:opacity 0.3s;';msg.textContent='Sending to '+tool+'...';document.body.appendChild(msg);const contextHtml='<!-- URL: '+location.href+' -->\n\n<!-- PARENT CONTEXT (1 level up) -->\n'+parentHtml+'\n\n<!-- TARGET ELEMENT -->\n'+element.outerHTML+'\n\n\nUSER_PROMPT: "'+(request||'No specific request')+'"';fetch('http://localhost:4123/grab',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:location.href,html:contextHtml,elementHtml:element.outerHTML,parentHtml:parentHtml,text:element.innerText?.substring(0,500),tool:tool,request:request,xpath:getXPath(element)})}).then(()=>{msg.style.opacity='0';setTimeout(()=>{msg.remove();const successMsg=document.createElement('div');successMsg.style.cssText='position:fixed;bottom:20px;right:20px;background:#28a745;color:white;padding:12px 24px;border-radius:8px;font-family:system-ui;z-index:99999;box-shadow:0 4px 12px rgba(0,0,0,0.2);';successMsg.textContent='âœ“ Ready! Switch to '+tool+' and paste.';document.body.appendChild(successMsg);setTimeout(()=>successMsg.remove(),2500);},300);}).catch((err)=>{msg.style.background='#dc3545';msg.textContent='Error: Is VS Code running?';console.error(err);setTimeout(()=>msg.remove(),3000);});}})();