javascript:(function(){if(window.grabAndAskInjected&&window.grabAndAskTimeout&&Date.now()-window.grabAndAskTimeout>12e4){window.grabAndAskInjected=false}if(window.grabAndAskInjected){alert("Inspector already active! Click Cancel to reset.");return}window.grabAndAskInjected=true;window.grabAndAskTimeout=Date.now();window.elementTasks=window.elementTasks||[];let e=window.elementTasks,t=null,n=true;const i=10;const l=document.createElement("div");Object.assign(l.style,{position:"fixed",bottom:"20px",right:"20px",background:"#007acc",color:"white",padding:"12px 24px",borderRadius:"8px",fontFamily:"system-ui",zIndex:"99999",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",fontWeight:"500"});document.body.appendChild(l);const o=document.createElement("div");o.className="task-panel-ignore";o.style.cssText="position:fixed;bottom:20px;right:20px;width:350px;max-height:500px;background:#1e1e1e;color:#fff;border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:system-ui;z-index:100002;display:none;overflow:hidden;";o.innerHTML=`<div style="padding:12px 16px;border-bottom:1px solid #444;display:flex;align-items:center;justify-content:space-between;"><h3 style="margin:0;font-size:14px;font-weight:600;">Task List (<span class="task-count">0</span>/${i})</h3><div style="display:flex;gap:6px;"><button class="minimize-btn" title="Minimize" style="background:none;border:none;color:#999;cursor:pointer;font-size:18px;padding:0;width:24px;height:24px;">−</button><button class="close-panel" title="Close" style="background:none;border:none;color:#999;cursor:pointer;font-size:18px;padding:0;width:24px;height:24px;">×</button></div></div><div class="task-list" style="padding:12px;max-height:350px;overflow-y:auto;"></div><div style="padding:12px;border-top:1px solid #444;display:flex;gap:8px;"><button class="send-all-btn" style="flex:1;padding:8px;background:#007acc;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:12px;">Send to VS Code</button><button class="copy-clipboard-btn" style="flex:1;padding:8px;background:#28a745;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:12px;">Copy</button><button class="clear-all-btn" style="padding:8px 12px;background:#444;color:white;border:none;border-radius:4px;cursor:pointer;font-size:12px;">Clear</button></div>`;document.body.appendChild(o);const r=o.querySelector(".task-count");const a=o.querySelector(".task-list");const s=o.querySelector(".minimize-btn");const c=o.querySelector(".close-panel");const d=o.querySelector(".clear-all-btn");const u=o.querySelector(".copy-clipboard-btn");const p=o.querySelector(".send-all-btn");let y=false;function m(){const t=e.length;r.textContent=t;l.textContent=t>=i?`Limit reached (${i}/${i}) - Time to send!`:`Click elements to add tasks (${t}/${i})`;l.style.background=t>=i?"#dc3545":"#007acc"}function g(t,i="#007acc",l=2500){const o=document.createElement("div");o.className="task-panel-ignore";o.style.cssText=`position:fixed;top:20px;right:20px;background:${i};color:white;padding:12px 24px;border-radius:8px;font-family:system-ui;z-index:100005;box-shadow:0 4px 12px rgba(0,0,0,0.2);font-weight:500;`;o.textContent=t;document.body.appendChild(o);setTimeout(()=>o.remove(),l)}function h(){a.innerHTML="";if(e.length===0){a.innerHTML='<div style="text-align:center;color:#999;padding:20px;">No tasks</div>';return}e.forEach((t,n)=>{const i=document.createElement("div");i.style.cssText="background:#2d2d2d;padding:8px;border-radius:4px;margin-bottom:6px;border:1px solid #444;display:flex;align-items:center;gap:6px;";const l=document.createElement("input");l.type="checkbox";l.checked=!!t.completed;l.dataset.idx=n;l.style.cursor="pointer";l.addEventListener("change",e=>{window.elementTasks[e.target.dataset.idx].completed=e.target.checked});const o=document.createElement("input");o.value=t.request||"";o.placeholder="comment...";o.dataset.idx=n;o.style.cssText="flex:1;background:transparent;border:none;color:#fff;font-size:12px;padding:2px 4px;border-bottom:1px solid #444;outline:none;";o.addEventListener("input",e=>{window.elementTasks[e.target.dataset.idx].request=e.target.value});const r=document.createElement("button");r.textContent="×";r.dataset.idx=n;r.style.cssText="background:none;border:none;color:#dc3545;cursor:pointer;font-size:14px;";r.addEventListener("click",t=>{window.elementTasks.splice(t.target.dataset.idx,1);h();m()});i.appendChild(l);i.appendChild(o);i.appendChild(r);a.appendChild(i)})}function f(e){if(!e)return"";if(e.id)return`//*[@id="${e.id}"]`;if(e===document.body)return e.tagName.toLowerCase();let t=1;const n=e.parentNode?e.parentNode.children:[];for(let i=0;i<n.length;i++){if(n[i]===e)break;if(n[i].tagName===e.tagName)t++}return f(e.parentNode)+"/"+e.tagName.toLowerCase()+"["+t+"]"}function w(){let t=`<!-- URL: ${location.href} -->\n\n## TASK LIST:\n\n`;if(e.length===0){t+="No tasks.\n"}else{e.forEach((e,n)=>{const i=e.completed?"✓":" ";const l=e.request?.trim()||"No description";const o=e.xpath||"";t+=`#${n+1}. [${i}] ${l}\n`;if(o)t+=`   XPath: ${o}\n`;t+="\n"})}t+="\n## HTML REFERENCES:\n\n";e.forEach((e,n)=>{t+=`<!-- #element-${n+1} -->\n`;t+=(e.html||"")+"\n\n"});return t}s.addEventListener("click",()=>{y=!y;a.style.display=y?"none":"block";p.parentElement.style.display=y?"none":"flex";s.textContent=y?"+":"−"});c.addEventListener("click",()=>{o.style.display="none"});d.addEventListener("click",()=>{if(confirm("Clear all tasks?")){e.length=0;h();m();o.style.display="none";g("✓ All items cleared","#dc3545")}});u.addEventListener("click",()=>{if(e.length===0){g("No tasks to copy","#dc3545");return}navigator.clipboard.writeText(w()).then(()=>{g(`✓ Copied ${e.length} tasks`,"#28a745")})});p.addEventListener("click",()=>{if(e.length===0){g("No tasks to send","#dc3545");return}g("Sending...","#007acc",1e3);fetch("http://localhost:4123/grab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:location.href,html:w(),tool:"ampcode",tasks:window.elementTasks,taskCount:e.length})}).then(()=>{g(`✓ Sent ${e.length} tasks`,"#28a745");e.length=0;h();m();o.style.display="none"}).catch(e=>{g("✗ Error: Is VS Code running?","#dc3545",3e3);console.error(e)})});document.addEventListener("mouseover",i=>{if(!n||i.target.closest(".task-panel-ignore"))return;if(t&&t!==i.target)t.style.outline="";t=i.target;i.target.style.outline="2px solid #007acc"});document.addEventListener("mouseout",e=>{if(!n||e.target.closest(".task-panel-ignore"))return;if(e.target===t){e.target.style.outline="";t=null}});document.addEventListener("click",i=>{if(!n||i.target.closest(".task-panel-ignore"))return;i.preventDefault();i.stopPropagation();if(t)t.style.outline="";if(e.length>=i){alert(`Limit reached (${i}/${i}). Send or clear tasks first.`);n=false;return}showModal(i.target)},true);document.addEventListener("keydown",e=>{if(e.key==="Escape"){n=!n;if(!n){if(t)t.style.outline="";g("Capture paused","#dc3545",1500)}else{if(window.elementTasks.length>=i){n=false;g("Cannot enable: task limit reached","#dc3545",1500)}else{g("Capture enabled","#28a745",1500)}}}});window.addEventListener("beforeunload",()=>{if(t)t.style.outline="";l.remove()});function showModal(i){i.style.outline="3px solid #007acc";i.style.boxShadow="0 0 0 3px rgba(0,122,204,0.3)";const l=document.createElement("div");l.className="task-panel-ignore";l.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:100003;";const o=document.createElement("div");o.className="task-panel-ignore";o.style.cssText="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#1e1e1e;color:#fff;padding:20px;border-radius:8px;width:400px;box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:system-ui;z-index:100004;";o.innerHTML=`<h2 style="margin:0 0 12px 0;font-size:15px;font-weight:600;">Add Task</h2><label style="display:block;margin-bottom:8px;"><textarea placeholder="e.g., Make button larger, change color to red, fix alignment..." style="width:100%;padding:8px;background:#2d2d2d;color:#fff;border:1px solid #007acc;border-radius:4px;font-size:12px;font-family:system-ui;resize:vertical;min-height:60px;box-sizing:border-box;"></textarea></label><div style="display:flex;gap:8px;"><button class="add-task-btn" style="flex:1;padding:10px;background:#007acc;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:500;font-size:13px;">Add to List</button></div>`;l.appendChild(o);document.body.appendChild(l);const r=o.querySelector("textarea");const a=o.querySelector(".add-task-btn");function s(){i.style.outline="";i.style.boxShadow="";l.remove();n=window.elementTasks.length<MAX_TASKS}a.addEventListener("click",()=>{window.elementTasks.push({id:`element-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,html:i.outerHTML,request:r.value.trim(),completed:false,xpath:f(i)});h();m();panel.style.display="block";s()});l.addEventListener("click",e=>{if(e.target===l)s()});r.addEventListener("keydown",e=>{if(e.key==="Escape")s()});setTimeout(()=>r.focus(),100)}h();m();g("Inspector activated!","#007acc",3e3)})();